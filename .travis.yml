language: node_js
node_js:
    - 12
    - 11
    - 10
    - 9
    - 8
    - 7
    - 6

script:
    - npm test
    - codecov -f coverage/*.json
    - npm i -g babel
    - npm run build
    - rsync -avh --progress ./types/ ./

jobs:
    include:
        - stage: Deploy docs to Github Pages
          script:
              - git config --global user.name "${GH_NAME}"
              - git config --global user.email "${GH_EMAIL}"
              - echo "machine github.com login ${GH_NAME} password ${GH_TOKEN}" > ~/.netrc
              - cd docs/documentation && npm i && GIT_USER="${GH_NAME}" npm run deploy
        - stage: Deploy to NPM
          on:
              branch: master
          deploy:
              provider: npm
              edge: true
              email: '$NPM_EMAIL'
              api_key: '$NPM_API_TOKEN'

notifications:
    email: false # default notification method
    slack:
        rooms:
            - secure: ${SLK}
        on_success: always
        on_failure: always
        template:
            - 'Repo `%{repository_slug}` *%{result}* build (<%{build_url}|#%{build_number}>) for commit (<%{compare_url}|%{commit}>) on branch `%{branch}`.'
            - 'Execution time: *%{duration}*'
            - 'Message: %{message}'

notifications:
  slack:
    rooms:
      - secure: "${SLK}"
    on_success: always